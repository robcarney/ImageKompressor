# ImageKompressor
## Overview
ImageKompressor uses the K-Means clustering algorithm to compress an image by identifying certain key RGB values and using those exclusively, rather than allowing any arbitrary RGB value. The K-Means clustering algorithm does this using the following steps iteratively: 

* __Assign Centroids__: For each pixel in the image, the algorithm finds the centroid closest to its pixel value by Euclidean distance. 
* __Update Centroids__: New centroids are generated by taking the average of all pixels assigned to a given centroid and updating that centroid to the new average.

After iterating this a certain number of times, we achieve centroids which accurately capture clusters in the data. For image compression, this means that we get a certain colors (each centroid represents a color) which capture much of the color data for the picture. Each pixel, rather than getting an RGB value, simply contains a centroid index representing which color to use.

## Example
__Original image__

![Original image](/images/bird_uncompressed.png)

__Compressed images__

|               | 20 centroids  | 50 centroids  | 100 centroids |
| ------------- |:-------------:| -----:| ----:|
| __25 iterations__  | ![Compressed 20/25](/images/compressed_img_20_25.png) | ![Compressed 50/25](/images/compressed_img_50_25.png) | ![Compressed 100/25](/images/compressed_img_100_25.png) |
| __50 iterations__  | ![Compressed 20/50](/images/compressed_img_20_50.png) | ![Compressed 50/50](/images/compressed_img_50_50.png) | ![Compressed 100/50](/images/compressed_img_100_50.png) |
| __100 iterations__ | ![Compressed 20/100](/images/compressed_img_20_100.png) | ![Compressed 50/100](/images/compressed_img_50_100.png) | ![Compressed 100/100](/images/compressed_img_100_100.png) |
## Technical details
The image compression is done using a combination of Python (using NumPy) and OpenCL to use to GPU to achieve greater concurrency where appropriate. The assignment stage is done via an OpenCL kernel which finds the closest centroid for each pixel concurrently. Then, the update happens via basic NumPy operations, and so on. 
## How to run
__Environment Setup__
As this project makes use of OpenCL, it is required that you have an OpenCL SDK installed on your machine.

For the Python requirements, it is recommended to use [CondaForge](https://conda-forge.org/) to run. You can follow the instructions [here](https://documen.tician.de/pyopencl/misc.html), and this should set you up with all necessary dependencies.
__Running the program__
After cloning the repo, navigate to the `src/` directory. From here, you can run the program as follows:
```
$ python main.py -h
usage: main.py [-h] [--img IMG_FILE] [--out OUT_FILE]
               [--num-centroids NUM_CENTROIDS] [--iters ITERS]

optional arguments:
  -h, --help            show this help message and exit
  --img IMG_FILE        File location for image to be compressed (default is
                        ../images/bird_uncompressed.png)
  --out OUT_FILE        File location for compressed image to be stored
                        (default is ../images/compressed_img.png)
  --num-centroids NUM_CENTROIDS
                        The number of centroids to use in the K-Means
                        clustering algorithm (default is 20)
  --iters ITERS         The number of iterations to run the K-Means clustering
                        algorithm (default is 50
```
Running simply `python main.py` will compress the example image, and store the compressed version at `images/compressed_img.png`.



